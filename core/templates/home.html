{% load sass_tags %}

<!doctype html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet" type="text/css"/>
    <link href="{% sass_src 'css/style.scss' %}" rel="stylesheet" type="text/css">
</head>
<body>

<h1>Election 19</h1>



<div class="rule">
    If <input class="pc">% of {% include "select.html"%} voters voted for {% include "select.html"%}.
</div>
{% include "map.svg" %}

<script>
var data = {};
fetch(`/data/`).then(
    (response) => response.json()
).then((json) => {
    data = json;

    rule = [1, "Liberal Democrat", "Labour"];

    var newData = {}
    for (conId in data) {


        var parties = data[conId].parties;
        var prevWinner = Object.keys(parties).reduce(
            function(a, b){ return parties[a] > parties[b] ? a : b }
        );

        if (rule[1] in parties && rule[2] in parties) {
            voters = parseInt(parties[rule[1]] * rule[0]);
            parties[rule[1]] -= voters;
            parties[rule[2]] += voters;
        }

        var newWinner = Object.keys(parties).reduce(
            function(a, b){ return parties[a] > parties[b] ? a : b }
        );


        var lookup = {
            "Conservative": "rgb(5, 117, 201)",
            "Labour": "rgb(223, 29, 14)",
            "Liberal Democrat": "rgb(239, 172, 24)",
            "Scottish National Party": "rgb(248, 237, 46)",
            "Green": "rgb(95, 178, 95)",
            "The Brexit Party": "#02b6d7"
        }

        if (newWinner !== prevWinner) {
            document.getElementById(conId).style.fill = lookup[newWinner];
            
        }
    }


})
</script>

</body>
</html>